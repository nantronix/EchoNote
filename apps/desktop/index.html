<!doctype html>
<html lang="en">
  <head>
    <!-- <script src="https://unpkg.com/react-scan/dist/auto.global.js"></script> -->
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>EchoNote</title>
    <style>
      html, body, #root {
        margin: 0;
        padding: 0;
        width: 100%;
        height: 100%;
        background-color: #ffffff;
      }
      #initial-loader {
        display: flex;
        align-items: center;
        justify-content: center;
        height: 100vh;
        width: 100vw;
        background: #ffffff;
      }
      #initial-loader .spinner {
        width: 32px;
        height: 32px;
        border: 3px solid #e5e5e5;
        border-top-color: #3b82f6;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }
      @keyframes spin {
        to { transform: rotate(360deg); }
      }
    </style>
    <!-- Polyfill __TAURI_INTERNALS__ in iframe context (extension host). See docs/developers/extensions. -->
    <script>
      (function() {
        var isIframeContext = window.self !== window.top;
        if (!isIframeContext) return;

        window.__TAURI_INTERNALS__ = {
          _metadata: {
            currentWindow: { label: "iframe", kind: "WebviewWindow" },
            currentWebview: { label: "iframe", windowLabel: "iframe" },
            windows: [],
            webviews: []
          },
          invoke: function() { return Promise.reject(new Error("Tauri not available in iframe")); },
          transformCallback: function() { return 0; },
          convertFileSrc: function(path) { return path; }
        };
      })();
    </script>
  </head>
  <body spellcheck="false">
    <div id="initial-loader">
      <div class="spinner"></div>
    </div>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
    <script>
      // Hide initial loader once React renders
      window.addEventListener('DOMContentLoaded', function() {
        var checkRoot = setInterval(function() {
          var root = document.getElementById('root');
          if (root && root.children.length > 0) {
            var loader = document.getElementById('initial-loader');
            if (loader) loader.style.display = 'none';
            clearInterval(checkRoot);
          }
        }, 100);
        // Timeout after 30 seconds
        setTimeout(function() { clearInterval(checkRoot); }, 30000);
      });
    </script>
  </body>
</html>
